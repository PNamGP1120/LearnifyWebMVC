<!doctype html>
<html xmlns:th="http://www.thymeleaf.org">
    <head th:replace="~{base :: head-resources}"></head>
    <body>
        <div th:replace="~{base :: layout(~{::content})}">
            <div th:fragment="content">

                <h2 class="my-4">üìã Danh s√°ch Enrollments</h2>

                <!-- B·ªô l·ªçc -->
                <form method="get" class="row g-2 mb-3">
                    <div class="col-md-3">
                        <select name="studentId" class="form-select">
                            <option value="">-- Ch·ªçn h·ªçc vi√™n --</option>
                            <option th:each="s : ${students}"
                                    th:value="${s.id}"
                                    th:text="${s.fullName}"
                                    th:selected="${param.studentId == s.id}"></option>
                        </select>
                    </div>
                    <div class="col-md-3">
                        <select name="courseId" class="form-select">
                            <option value="">-- Ch·ªçn kho√° h·ªçc --</option>
                            <option th:each="c : ${courses}"
                                    th:value="${c.id}"
                                    th:text="${c.title}"
                                    th:selected="${param.courseId == c.id}"></option>
                        </select>
                    </div>
                    <div class="col-md-3">
                        <select name="accessStatus" class="form-select">
                            <option value="">-- Tr·∫°ng th√°i truy c·∫≠p --</option>
                            <option value="ACTIVE" th:selected="${param.accessStatus == 'ACTIVE'}">ƒêang h·ªçc</option>
                            <option value="EXPIRED" th:selected="${param.accessStatus == 'EXPIRED'}">H·∫øt h·∫°n</option>
                            <option value="BLOCKED" th:selected="${param.accessStatus == 'BLOCKED'}">B·ªã ch·∫∑n</option>
                        </select>
                    </div>
                    <div class="col-md-2">
                        <button class="btn btn-primary w-100" type="submit">üîç L·ªçc</button>
                    </div>
                </form>

                <!-- B·∫£ng -->
                <table class="table table-bordered table-hover">
                    <thead class="table-light">
                        <tr>
                            <th>ID</th>
                            <th>H·ªçc vi√™n</th>
                            <th>Kho√° h·ªçc</th>
                            <th>Ng√†y ghi danh</th>
                            <th>Tr·∫°ng th√°i truy c·∫≠p</th>
                            <th>Thanh to√°n</th>
                            <th>H√†nh ƒë·ªông</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr th:each="e : ${enrollments}">
                            <td th:text="${e.id}"></td>
                            <td th:text="${e.studentId.fullName}"></td>
                            <td th:text="${e.courseId.title}"></td>
                            <td th:text="${#dates.format(e.enrolledAt, 'dd/MM/yyyy HH:mm')}"></td>
                            <td th:text="${e.accessStatus}"></td>
                            <td th:text="${paymentCounts[e.id]} + ' giao d·ªãch'"></td>

                            <td>
                                <a th:href="@{'/admin/enrollments/' + ${e.id}}" class="btn btn-sm btn-info">üëÅ</a>
                                <a th:href="@{'/admin/enrollments/' + ${e.id} + '/edit'}" class="btn btn-sm btn-warning">‚úè</a>
                                <a th:href="@{'/admin/enrollments/' + ${e.id} + '/delete'}"
                                   class="btn btn-sm btn-danger"
                                   onclick="return confirm('Xo√° enrollment n√†y?')">üóë</a>
                            </td>
                        </tr>
                    </tbody>
                </table>

                <!-- Ph√¢n trang -->
                <nav th:if="${count > pageSize}" class="mt-3">
                    <ul class="pagination">
                        <li class="page-item" th:classappend="${page == 1} ? 'disabled'">
                            <a class="page-link" th:href="@{|?page=${page-1}&pageSize=${pageSize}|}">Tr∆∞·ªõc</a>
                        </li>
                        <li class="page-item"
                            th:each="i : ${#numbers.sequence(1, T(java.lang.Math).ceil(count / pageSize))}"
                            th:classappend="${page == i} ? 'active'">
                            <a class="page-link" th:href="@{|?page=${i}&pageSize=${pageSize}|}" th:text="${i}"></a>
                        </li>
                        <li class="page-item" th:classappend="${page * pageSize >= count} ? 'disabled'">
                            <a class="page-link" th:href="@{|?page=${page+1}&pageSize=${pageSize}|}">Ti·∫øp</a>
                        </li>
                    </ul>
                </nav>

                <a th:href="@{/admin/enrollments/add}" class="btn btn-success mt-3">‚ûï Th√™m Enrollment</a>

            </div>
        </div>
    </body>
</html>
